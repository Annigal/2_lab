# üîê –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: XSS (Cross-Site Scripting)

## üéØ –ó–∞–¥–∞–Ω–∏–µ
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ Node.js + Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —É—è–∑–≤–∏–º–æ—Å—Ç—å—é XSS, –∞ –∑–∞—Ç–µ–º –∑–∞—â–∏—Ç–∏—Ç—å –µ–≥–æ.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

### –í–∞—Ä–∏–∞–Ω—Ç 1: CMD / Batch
```cmd
cd project
install.bat     # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm start       # –ó–∞–ø—É—Å–∫ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
cd project
npm install
npm start
```

üîó –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îú‚îÄ‚îÄ üìÑ .gitignore              # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Git (node_modules/)
‚îú‚îÄ‚îÄ üìÑ app.js                  # ‚úÖ –ó–∞—â–∏—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üìÑ app-vulnerable.js       # ‚ö†Ô∏è –£—è–∑–≤–∏–º–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
‚îú‚îÄ‚îÄ üìÑ package.json            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ üìÑ package-lock.json       # Lock-—Ñ–∞–π–ª npm
‚îú‚îÄ‚îÄ üìÑ install.bat             # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (CMD, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –≤—ã–≤–æ–¥)
‚îú‚îÄ‚îÄ üìÑ install.ps1             # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (PowerShell, —Ä—É—Å—Å–∫–∏–π –≤—ã–≤–æ–¥)
‚îú‚îÄ‚îÄ üìÑ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ üìÅ views/
    ‚îú‚îÄ‚îÄ üìÑ index.ejs           # ‚úÖ –ó–∞—â–∏—â—ë–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω
    ‚îî‚îÄ‚îÄ üìÑ index-vulnerable.ejs # ‚ö†Ô∏è –£—è–∑–≤–∏–º—ã–π —à–∞–±–ª–æ–Ω
```

---

## üéØ –ß–∞—Å—Ç—å 1: –ü–æ–Ω–∏–º–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ XSS

### –ß—Ç–æ —Ç–∞–∫–æ–µ Stored XSS?
**Stored XSS** (—Ö—Ä–∞–Ω–∏–º–∞—è –º–µ–∂—Å–∞–π—Ç–æ–≤–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –£—è–∑–≤–∏–º—ã–π –∫–æ–¥ (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è):
```javascript
// ‚ö†Ô∏è –ù–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –í –ü–†–û–î–ê–ö–®–ï–ù–ï!
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏
app.post('/comment', (req, res) => {
  comments.push(req.body.text);  // ‚ùå –û–ø–∞—Å–Ω–æ!
  res.redirect('/');
});

// –í—ã–≤–æ–¥ –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ EJS
<div><%- comment %></div>  // ‚ùå <%- –≤—ã–ø–æ–ª–Ω—è–µ—Ç HTML, —É—è–∑–≤–∏–º–æ!
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Ç–∞–∫–∞:
1. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤–≤–æ–¥–∏—Ç: `<script>alert('XSS!')</script>`
2. –°–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ "–±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
3. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∂–µ—Ä—Ç–≤—ã
4. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è: –∫—Ä–∞–∂–∞ cookies, —Ä–µ–¥–∏—Ä–µ–∫—Ç, –∫–µ–π–ª–æ–≥–≥–µ—Ä—ã

---

## üõ°Ô∏è –ß–∞—Å—Ç—å 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—Ç—ã

### 1. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –≤ EJS
```ejs
<!-- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ: <%= –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç HTML -->
<div><%= comment.text %></div>

<!-- ‚ùå –û–ø–∞—Å–Ω–æ: <%- –≤—ã–≤–æ–¥–∏—Ç "—Å—ã—Ä–æ–π" HTML -->
<div><%- comment.text %></div>
```

### 2. –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ —Å DOMPurify
```javascript
const { JSDOM } = require('jsdom');
const DOMPurify = require('dompurify')(new JSDOM('').window);

app.post('/comment', (req, res) => {
  const cleanText = DOMPurify.sanitize(req.body.text);
  comments.push(cleanText);  // ‚úÖ –¢–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
  res.redirect('/');
});
```

### 3. Content Security Policy —Å Helmet
```javascript
const helmet = require('helmet');

app.use(helmet.contentSecurityPolicy({
  directives: {
    defaultSrc: ["'self'"],
    scriptSrc: ["'self'"],  // ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç inline-—Å–∫—Ä–∏–ø—Ç—ã
    styleSrc: ["'self'", "'unsafe-inline'"],
    // ... –¥—Ä—É–≥–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
  }
}));
```

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```javascript
app.use(helmet.xssFilter());      // –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
app.use(helmet.noSniff());        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ MIME-sniffing
app.use(helmet.frameguard());     // –ó–∞—â–∏—Ç–∞ –æ—Ç clickjacking
```

### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
```javascript
// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã (–¥–æ–ø. –∑–∞–¥–∞–Ω–∏–µ)
if (text.length > 200) {
  text = text.substring(0, 200);
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—Ç—ã

### –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏:
```html
<script>alert('XSS!')</script>
<img src=x onerror="alert('XSS')">
<svg onload="alert('XSS')">
javascript:alert('XSS')
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –°–∫—Ä–∏–ø—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ CSP (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!)
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ "–æ—á–∏—â–µ–Ω–Ω–æ–º" –≤–∏–¥–µ

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ CSP:
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –∑–∞–ø—Ä–æ—Å –∫ `/`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Security-Policy`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `script-src` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ `'self'`

---
