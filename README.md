# üîê –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: XSS (Cross-Site Scripting)

> üì¶ **GitHub**: https://github.com/Annigal/2_lab

## üéØ –ó–∞–¥–∞–Ω–∏–µ
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ Node.js + Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —É—è–∑–≤–∏–º–æ—Å—Ç—å—é XSS, –∞ –∑–∞—Ç–µ–º –∑–∞—â–∏—Ç–∏—Ç—å –µ–≥–æ.

---

## üì¶ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ GitHub (—á–µ—Ä–µ–∑ CMD)

### –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```cmd
REM 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd C:\Users\yiun5\OneDrive\–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª\IT_Hub\4\2\–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π\2_lab\project

REM 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Git
git init

REM 3. –ü—Ä–∏–≤—è–∑–∫–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git remote add origin https://github.com/Annigal/2_lab.git

REM 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (node_modules –∏—Å–∫–ª—é—á—ë–Ω —á–µ—Ä–µ–∑ .gitignore)
git add .

REM 5. –ü–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç
git commit -m "feat: XSS lab - vulnerable and protected app"

REM 6. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub
git push -u origin main
```

> ‚ö†Ô∏è **–ü–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π**: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `2_lab` –Ω–∞ https://github.com/new  
> ‚ùå –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ README/.gitignore –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ ‚Äî –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ!

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

### –í–∞—Ä–∏–∞–Ω—Ç 1: CMD / Batch
```cmd
cd project
install.bat     # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm start       # –ó–∞–ø—É—Å–∫ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: PowerShell
```powershell
cd project
.\install.ps1   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —Ä—É—Å—Å–∫–∏–º –≤—ã–≤–æ–¥–æ–º
npm start       # –ó–∞–ø—É—Å–∫ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
cd project
npm install
npm start
```

üîó –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îú‚îÄ‚îÄ üìÑ .gitignore              # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Git (node_modules/)
‚îú‚îÄ‚îÄ üìÑ app.js                  # ‚úÖ –ó–∞—â–∏—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üìÑ app-vulnerable.js       # ‚ö†Ô∏è –£—è–∑–≤–∏–º–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
‚îú‚îÄ‚îÄ üìÑ package.json            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ üìÑ package-lock.json       # Lock-—Ñ–∞–π–ª npm
‚îú‚îÄ‚îÄ üìÑ install.bat             # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (CMD, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –≤—ã–≤–æ–¥)
‚îú‚îÄ‚îÄ üìÑ install.ps1             # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (PowerShell, —Ä—É—Å—Å–∫–∏–π –≤—ã–≤–æ–¥)
‚îú‚îÄ‚îÄ üìÑ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ üìÅ views/
    ‚îú‚îÄ‚îÄ üìÑ index.ejs           # ‚úÖ –ó–∞—â–∏—â—ë–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω
    ‚îî‚îÄ‚îÄ üìÑ index-vulnerable.ejs # ‚ö†Ô∏è –£—è–∑–≤–∏–º—ã–π —à–∞–±–ª–æ–Ω
```

---

## üéØ –ß–∞—Å—Ç—å 1: –ü–æ–Ω–∏–º–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ XSS

### –ß—Ç–æ —Ç–∞–∫–æ–µ Stored XSS?
**Stored XSS** (—Ö—Ä–∞–Ω–∏–º–∞—è –º–µ–∂—Å–∞–π—Ç–æ–≤–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –£—è–∑–≤–∏–º—ã–π –∫–æ–¥ (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è):
```javascript
// ‚ö†Ô∏è –ù–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –í –ü–†–û–î–ê–ö–®–ï–ù–ï!
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏
app.post('/comment', (req, res) => {
  comments.push(req.body.text);  // ‚ùå –û–ø–∞—Å–Ω–æ!
  res.redirect('/');
});

// –í—ã–≤–æ–¥ –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ EJS
<div><%- comment %></div>  // ‚ùå <%- –≤—ã–ø–æ–ª–Ω—è–µ—Ç HTML, —É—è–∑–≤–∏–º–æ!
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Ç–∞–∫–∞:
1. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤–≤–æ–¥–∏—Ç: `<script>alert('XSS!')</script>`
2. –°–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ "–±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
3. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∂–µ—Ä—Ç–≤—ã
4. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è: –∫—Ä–∞–∂–∞ cookies, —Ä–µ–¥–∏—Ä–µ–∫—Ç, –∫–µ–π–ª–æ–≥–≥–µ—Ä—ã

---

## üõ°Ô∏è –ß–∞—Å—Ç—å 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—Ç—ã

### 1. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –≤ EJS
```ejs
<!-- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ: <%= –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç HTML -->
<div><%= comment.text %></div>

<!-- ‚ùå –û–ø–∞—Å–Ω–æ: <%- –≤—ã–≤–æ–¥–∏—Ç "—Å—ã—Ä–æ–π" HTML -->
<div><%- comment.text %></div>
```

### 2. –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ —Å DOMPurify
```javascript
const { JSDOM } = require('jsdom');
const DOMPurify = require('dompurify')(new JSDOM('').window);

app.post('/comment', (req, res) => {
  const cleanText = DOMPurify.sanitize(req.body.text);
  comments.push(cleanText);  // ‚úÖ –¢–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
  res.redirect('/');
});
```

### 3. Content Security Policy —Å Helmet
```javascript
const helmet = require('helmet');

app.use(helmet.contentSecurityPolicy({
  directives: {
    defaultSrc: ["'self'"],
    scriptSrc: ["'self'"],  // ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç inline-—Å–∫—Ä–∏–ø—Ç—ã
    styleSrc: ["'self'", "'unsafe-inline'"],
    // ... –¥—Ä—É–≥–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
  }
}));
```

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```javascript
app.use(helmet.xssFilter());      // –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
app.use(helmet.noSniff());        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ MIME-sniffing
app.use(helmet.frameguard());     // –ó–∞—â–∏—Ç–∞ –æ—Ç clickjacking
```

### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
```javascript
// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã (–¥–æ–ø. –∑–∞–¥–∞–Ω–∏–µ)
if (text.length > 200) {
  text = text.substring(0, 200);
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—Ç—ã

### –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏:
```html
<script>alert('XSS!')</script>
<img src=x onerror="alert('XSS')">
<svg onload="alert('XSS')">
javascript:alert('XSS')
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –°–∫—Ä–∏–ø—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ CSP (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!)
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ "–æ—á–∏—â–µ–Ω–Ω–æ–º" –≤–∏–¥–µ

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ CSP:
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –∑–∞–ø—Ä–æ—Å –∫ `/`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Security-Policy`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `script-src` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ `'self'`

---

## üìö –¢–µ–æ—Ä–∏—è: –£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã –æ—Ç XSS

| –£—Ä–æ–≤–µ–Ω—å | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------|----------|
| üî¥ 0 | –ù–µ—Ç –∑–∞—â–∏—Ç—ã | –ü–æ–ª–Ω—ã–π XSS |
| üü° 1 | –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞ | `<%= %>` –≤ EJS |
| üü¢ 2 | –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ | DOMPurify |
| üîµ 3 | CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ | Helmet + –ø–æ–ª–∏—Ç–∏–∫–∏ |
| üü£ 4 | –í–∞–ª–∏–¥–∞—Ü–∏—è + —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è + CSP | –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞ |

**–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: –£—Ä–æ–≤–µ–Ω—å 4 ‚úÖ

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –≤–≤–æ–¥—É** ‚Äî –≤—Å–µ–≥–¥–∞ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ
2. **–≠–∫—Ä–∞–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ** ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSP** ‚Äî –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π –∑–∞—â–∏—Ç—ã
4. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥—è—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—Ä–æ–¥–µ OWASP ZAP

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [OWASP XSS Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)
- [DOMPurify GitHub](https://github.com/cure53/DOMPurify)
- [Helmet.js Documentation](https://helmetjs.github.io/)
- [Content Security Policy Guide](https://developer.mozilla.org/ru/docs/Web/HTTP/CSP)

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `<%= %>` –∏ `<%- %>` –≤ EJS?
2. –ü–æ—á–µ–º—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–ª—å–∫–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–≤–æ–¥–∞?
3. –ö–∞–∫ CSP –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ inline-—Å–∫—Ä–∏–ø—Ç–æ–≤?
4. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç DOMPurify –∏ –ø–æ—á–µ–º—É –æ–Ω –Ω—É–∂–µ–Ω?
5. –ö–∞–∫–∏–µ –µ—â—ë —Ç–∏–ø—ã XSS –≤—ã –∑–Ω–∞–µ—Ç–µ?

---

> üí° **–°–æ–≤–µ—Ç**: –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –∑–∞—â–∏—Ç—É "–≤ –≥–ª—É–±–∏–Ω—É" (defense in depth) ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã –Ω–∞–¥—ë–∂–Ω–µ–µ –æ–¥–Ω–æ–≥–æ!
